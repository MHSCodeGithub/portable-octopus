<!doctype html>
<html>

<head>
  <title>Kingdom | Octable Portopus</title>
  <link rel="stylesheet" href="css/normalize.css">
  <link rel="stylesheet" href="css/game.css">
  <script src="panzoom/test/libs/jquery.js"></script>
  <script src="panzoom/dist/jquery.panzoom.js"></script>
  <script src="panzoom/test/libs/jquery.mousewheel.js"></script>
</head>

<body>
  <!-- ## Depracted chat system ## (IGNORE)
    <div id="chat">
      <ul id="chat-output"></ul>
      <form id="chat-input" action="">
        <input id="message" autocomplete="off" /><button>Send</button>
      </form>
    </div>
    -->

  <!-- GAME
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <section id="game">
    <div class="parent">
      <!--Actual Game-->
      <div class="panzoom">
        <div id="game-container">
        </div>
      </div>

      <!--Shop Menu-->
      <div id="shop-modal" class="modal">
        <div id="shop-item-wrap" class="modal-content">
          <!--Shop Item-->
          <div class="shop-item">
            <h2 class="item-name">I is item</h2>
            <img src="http://via.placeholder.com/80x80" alt="" class="">
            <p class="item-desc">I am an item. I produce happiness at a rate of 5/h. Don't be sad :)</p>
            <button class="item-buy-btn">$000</button>
          </div>

          <div class="shop-item">
            <h2 class="item-name">I is item</h2>
            <img src="http://via.placeholder.com/80x80" alt="" class="">
            <p class="item-desc">I am an item. I produce happiness at a rate of 5/h. Don't be sad :)</p>
            <button class="item-buy-btn">$000</button>
          </div>

          <div class="shop-item">
            <h2 class="item-name">I is item</h2>
            <img src="http://via.placeholder.com/80x80" alt="" class="">
            <p class="item-desc">I am an item. I produce happiness at a rate of 5/h. Don't be sad :)</p>
            <button class="item-buy-btn">$000</button>
          </div>

          <div class="shop-item">
            <h2 class="item-name">I is item</h2>
            <img src="http://via.placeholder.com/80x80" alt="" class="">
            <p class="item-desc">I am an item. I produce happiness at a rate of 5/h. Don't be sad :)</p>
            <button class="item-buy-btn">$000</button>
          </div>

          <div class="shop-item">
            <h2 class="item-name">I is item</h2>
            <img src="http://via.placeholder.com/80x80" alt="" class="">
            <p class="item-desc">I am an item. I produce happiness at a rate of 5/h. Don't be sad :)</p>
            <button class="item-buy-btn">$000</button>
          </div>

          <div class="shop-item">
            <h2 class="item-name">I is item</h2>
            <img src="http://via.placeholder.com/80x80" alt="" class="">
            <p class="item-desc">I am an item. I produce happiness at a rate of 5/h. Don't be sad :)</p>
            <button class="item-buy-btn">$000</button>
          </div>

          <div class="shop-item">
            <h2 class="item-name">I is item</h2>
            <img src="http://via.placeholder.com/80x80" alt="" class="">
            <p class="item-desc">I am an item. I produce happiness at a rate of 5/h. Don't be sad :)</p>
            <button class="item-buy-btn">$000</button>
          </div>

          <div class="shop-item">
            <h2 class="item-name">I is item</h2>
            <img src="http://via.placeholder.com/80x80" alt="" class="">
            <p class="item-desc">I am an item. I produce happiness at a rate of 5/h. Don't be sad :)</p>
            <button class="item-buy-btn">$000</button>
          </div>
        </div>
      </div>

      <!--Market Menu-->
      <div id="market-modal" class="modal">
        <div class="modal-content">
          <h1>This will be Market</h1>
        </div>
      </div>

      <!--World Map-->
      <div id="map-modal" class="modal">
        <div class="modal-content">
          <h1>This will be map</h1>
        </div>
      </div>
    </div>
  </section>

  <!-- MENU
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <div id="menu">
    <button type="button" name="button" class="modal-btn" id="shop-btn">Shop</button>
    <button type="button" name="button" class="modal-btn" id="market-btn">Market</button>
    <button type="button" name="button" class="modal-btn" id="map-btn">World Map</button>
    <button type="button" name="button" class="modal-btn" id="logout-btn">Log Out</button>
  </div>

  <!-- SILLY SCRIPTS
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <script>
    (function() {
      var $section = $('#game');
      var $panzoom = $section.find('.panzoom').panzoom();
      $panzoom.parent().on('mousewheel.focal', function(e) {
        e.preventDefault();
        var delta = e.delta || e.originalEvent.wheelDelta;
        var zoomOut = delta ? delta < 0 : e.originalEvent.deltaY > 0;
        $panzoom.panzoom('zoom', zoomOut, {
          animate: true,
          focal: e
        });
      });
    })();
  </script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.1.1/socket.io.js"></script>
  <script src="https://code.jquery.com/jquery-1.11.1.js"></script>

  <script>
    function getCookie(cname) {
      var name = cname + "=";
      var decodedCookie = decodeURIComponent(document.cookie);
      var ca = decodedCookie.split(';');
      for (var i = 0; i < ca.length; i++) {
        var c = ca[i];
        while (c.charAt(0) == ' ') {
          c = c.substring(1);
        }
        if (c.indexOf(name) == 0) {
          return c.substring(name.length, c.length);
        }
      }
      return false;
    }

    var username = getCookie("username");
    var password = getCookie("password");

    if (!username || !password) {
      alert("Critical Error Please Login Again. (Reset session by re-opening browser)");
    }

    var me = {};

    $(function() {
      var socket = io.connect('http://localhost:3000');

      /* ## Depracted chat system ## (IGNORE)
      var now = new Date();
      $('#chat-input').submit(function(){
        if($('#message').val() != "") {
          socket.emit('chat message', {content: $('#message').val(), author: username, timeStamp: String(now.getUTCHours()+":"+now.getUTCMinutes()+":"+now.getUTCSeconds())});
          $('#message').val('');
        }
        return false;
      });*/

      // ## Depracted chat system ## (IGNORE)
      socket.on('chat message', function(msg) { // <-- Required for bug fix
        /*$('#chat-output').append($('<li>').text("["+msg.timeStamp+"] ["+msg.author+"] "+msg.content));
        $("#chat-output").animate({ scrollTop: $("#chat-output")[0].scrollHeight - $("#chat-output").height() }, 100);*/
      });

      socket.on('result', function(message) {
        alert(message);
      });

      function drawLine(startY, startX, color, endY, endX, id) {
        if (startX < endX) {
          for (var i = 0; i < (endX - startX) + 1; i++) {
            $(".y-" + startY + ".x-" + (i + startX)).css("background", color).addClass(id);
          }
        } else if (startX > endX) {
          for (var i = 0; i < (startX - endX) + 1; i++) {
            $(".y-" + startY + ".x-" + (startX - i)).css("background", color).addClass(id);
          }
        } else if (startY < endY) {
          for (var i = 0; i < (endY - startY) + 1; i++) {
            $(".y-" + (i + startY) + ".x-" + startX).css("background", color).addClass(id);
          }
        } else if (startY > endY) {
          for (var i = 0; i < (startY - endY) + 1; i++) {
            $(".y-" + (endY - i) + ".x-" + startX).css("background", color).addClass(id);
          }
        }
      }

      var total = 0;
      for (var i = 0; i < 18; i++) {
        for (var j = 0; j < 18; j++) {
          total++;
          $("#game-container").append("<div id='block-" + (total) + "' class='y-" + (i + 1) + " x-" + (j + 1) + "'> </div>");
        }
      }


      function drawFarm(x, y, stage) {
        $(".y-" + y + ".x-" + x).css("background", "url('img/farm" + stage + ".png')");
        $(".y-" + y + ".x-" + x).css("background-size", "contain");
        $(".y-" + y + ".x-" + x).addClass("farm0 built");
      }

      drawFarm(1, 1, 0);

      function drawSelect(x, y, reason) {
        $(".y-" + y + ".x-" + x).css("background", "url('img/selected-tile.png')");
        $(".y-" + y + ".x-" + x).css("background-size", "contain");
        $(".y-" + y + ".x-" + x).addClass("selected");
        $(".y-" + y + ".x-" + x).addClass(reason);
      }

      (function($) {
        $(document).on("click", ".info img", function() {
          $(this).parent().parent().removeClass("open");
          $(this).parent().remove();
        });

        // Code for modal interaction
        $(".modal-btn").click(function() {

          var target = $(this).attr('id').split('-')[0];
          if ($("#"+target+"-modal").css('display') == 'none') {
            $(".modal").css('display', 'none');
            $("#"+target+"-modal").css('display', 'block');
          } else {
            $("#"+target+"-modal").css('display', 'none');
          }
        });

        /*window.onclick = function(event) {
          if (event.target == modal) {
            modal.style.display = "none";
          }
        }*/
      })(jQuery);

      $(".farm0").click(function() {
        if ($(this).children().length == 0 && !$(this).hasClass("open")) {
          $(this).addClass("open");
          var classes = $(this).attr('class').split(" ");
          var x = classes[1].split("-")[1],
            y = classes[0].split("-")[1];

          $(this).append("<div class='info'><img src='img/exit.png' alt='exit' /><h1>House</h1><p>Houses NPCs.</p></div>")
        }
        /*else if($(this).children().length == 1) {
                   $(".info img").click(function () {
                     house0 = true;
                     $(".info").hide();
                   });
                 }*/
      });
    });
  </script>
</body>

</html>
